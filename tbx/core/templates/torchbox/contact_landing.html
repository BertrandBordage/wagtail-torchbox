{% extends "torchbox/base.html" %}
{% load static torchbox_tags wagtailcore_tags wagtailimages_tags %}
{% block googlemap %}
    <script src="https://maps.googleapis.com/maps/api/js"></script>
{% endblock %}
{% block content %}

    <div class="map" id="map"></div>
    <div class="container">
        <div class="contact">
        {% spaceless %}
        <div class="contact__block">
            <div class="find-us">
                <h1>Come say hello</h1>
                <div class="address">
                    <h3>Oxford</h3>
                    <p>Unit 9, Southill Business Park, Charlbury, OX7 3EW, UK</p>
                </div>
                <div class="address">
                    <h3>Bristol</h3>
                    <p>3rd Floor, 15 Colston Street, Bristol, BS1 5AP, UK</p>
                </div>
                <div class="address">
                    <h3>Philadelphia</h3>
                    <p>Indy Hall, 22 N. 3rd St., Philadelphia, PA 19106, US</p>
                </div>
            </div>
        </div>
        <div class="contact__block">
            <form class="contact-us" action="{% pageurl page %}" method="post">
                <h1>Thanks</h1>
                {{ page.thank_you_text|richtext }}
                {% csrf_token %}
                {{ form.as_p }}
            </form>
        </div>
        {% endspaceless %}
    </div>
{% endblock %}

<script type="text/javascript">
    $(function() {

        google.maps.event.addDomListener(window, 'load', init);

        function init() {
          var mapOptions = {
            zoom: 4,
            scrollwheel: false,
            center: new google.maps.LatLng(45, -30),
            styles: [{"featureType":"all","elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#000000"},{"lightness":40}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#000000"},{"lightness":16}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"lightness":"69"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":17},{"weight":1.2}]},{"featureType":"administrative.country","elementType":"geometry","stylers":[{"lightness":"35"}]},{"featureType":"administrative.country","elementType":"geometry.fill","stylers":[{"lightness":"1"}]},{"featureType":"administrative.province","elementType":"geometry.fill","stylers":[{"weight":"3.94"},{"lightness":"45"}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":21}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":16}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":19}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":17}]}]
        };

        var mapElement = document.getElementById('map');
        var map = new google.maps.Map(mapElement, mapOptions);

        function philiMarker() {
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(39.950865, -75.145590),
            map: map,
            title: 'PHILADELPHIA',
            icon: '{% static "torchbox/images/pin.png" %}'
          });
        }

        function oxfordMarker() {
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(51.858469, -1.480863),
            map: map,
            title: 'Oxford',
            icon: '{% static "torchbox/images/pin.png" %}'
          });
        }

        function bristolMarker() {
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(51.454814, -2.597802),
            map: map,
            title: 'Bristol',
            icon: '{% static "torchbox/images/pin.png" %}'
          });
        }

        philiMarker();
        oxfordMarker();
        
        var zoomLevel =  map.getZoom();

        // Only show second UK marker when zoomed in
        // Should be refactored to store markers in an array, and display required
        // Markers depending on zoom level
        map.addListener('zoom_changed', function() {
          if (zoomLevel > 5) { 
              oxfordMarker();
          } else {
              oxfordMarker();
              bristolMarker();
          }
        });
      }

    });
</script>
